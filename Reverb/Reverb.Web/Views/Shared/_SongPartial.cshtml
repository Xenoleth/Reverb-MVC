@using Reverb.Web.Models.Song
@model SongViewModel

@*
    TODO: Create better card for songs
*@
<div class="card">
    <div class="image">
        <img alt="cover-image" src=@Model.CoverUrl width="200" />
    </div>

    <p>Title</p>
    <p><b>@Model.Title</b></p>
    <p>Album</p>
    <p>@Model.Album</p>
    <p>Artist</p>
    <p>@Model.Artist</p>
    <p>Duration</p>
    @if (Model.Duration != null)
    {
        @(String.Format("{0}:{1:00} min", (int)Model.Duration / 60, (int)Model.Duration % 60))
    }
    else
    {
        <p>Unknown</p>
    }

    @if (User.Identity.IsAuthenticated)
    {
        using (Ajax.BeginForm(
                "Details",
                "Song",
                new { songId = Model.Id },
                new AjaxOptions
                {
                    HttpMethod = "POST"
                }))
        {
            <input type="submit" class="btn btn-primary" value="Details" />
        }
    }

    @* Fix random empty if by addind logic to the others with && *@
    @if (!User.Identity.IsAuthenticated)
    {

    }
    else if (!Model.Users.Contains(User.Identity.Name))
    {
        using (Ajax.BeginForm(
                "AddToFavorites",
                "Song",
                new { songId = Model.Id },
                new AjaxOptions
                {
                    HttpMethod = "POST"
                }))
        {
            <input type="submit" class="btn btn-success" value="Favorite" />
        }
    }
    else if(Model.Users.Contains(User.Identity.Name))
    {
        using (Ajax.BeginForm(
                        "RemoveFromFavorites",
                        "Song",
                        new { songId = Model.Id },
                        new AjaxOptions
                        {
                            HttpMethod = "POST"
                        }))
        {
            <input type="submit" class="btn btn-warning" value="Unfavorite" />
        }
    }

    @if (User.Identity.IsAuthenticated && User.IsInRole("Admin"))
    {
        @Html.ActionLink("Edit", "EditSong", "Song", new { songId = Model.Id }, new { @class = "btn btn-warning" })
    }

    @if (User.Identity.IsAuthenticated && User.IsInRole("Admin"))
    {
        using (Html.BeginForm("DeleteSong", "Song", new { songId = Model.Id }, FormMethod.Post))
        {
            <input type="submit" class="btn btn-danger" value="Delete" />
        }
    }
</div>